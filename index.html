<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸–ç•Œåœ°å›¾æ‹¼å›¾æ¸¸æˆ | World Map Puzzle</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://d3js.org/topojson.v3.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
    background: linear-gradient(135deg, #0a0f1e 0%, #111b33 50%, #0a1628 100%);
    color: #fff;
    min-height: 100vh;
    overflow: hidden;
    user-select: none;
  }

  #header {
    text-align: center;
    padding: 10px 0 2px;
    position: relative;
    z-index: 10;
  }

  #header h1 {
    font-size: 26px;
    font-weight: 700;
    background: linear-gradient(90deg, #34d399, #60a5fa, #a78bfa, #f472b6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 2px;
  }

  #header p {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 2px;
  }

  #controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
    position: relative;
    z-index: 20;
  }

  #search-box {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px 0 0 10px;
    padding: 9px 16px;
    color: #e2e8f0;
    font-size: 14px;
    width: 280px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  #search-box:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 12px rgba(96,165,250,0.25);
  }
  #search-box::placeholder { color: #64748b; text-transform: none; letter-spacing: 0; }

  #search-btn {
    background: linear-gradient(135deg, #3b82f6, #6366f1);
    border: none;
    color: #fff;
    padding: 9px 20px;
    border-radius: 0 10px 10px 0;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }
  #search-btn:hover {
    filter: brightness(1.15);
    box-shadow: 0 4px 15px rgba(99,102,241,0.4);
  }
  #search-btn:active { transform: scale(0.97); }
  #search-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    filter: none;
    box-shadow: none;
  }

  #search-hint {
    font-size: 11px;
    color: #64748b;
    margin-left: 8px;
    transition: all 0.3s;
  }
  #search-hint.error {
    color: #f87171;
    animation: shake 0.4s ease;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-4px); }
    40%, 80% { transform: translateX(4px); }
  }

  /* Autocomplete dropdown */
  #autocomplete {
    display: none;
    position: absolute;
    top: 44px;
    left: 50%;
    transform: translateX(calc(-140px - 30px));
    width: 336px;
    max-height: 240px;
    overflow-y: auto;
    background: rgba(15,23,42,0.97);
    border: 1px solid rgba(96,165,250,0.25);
    border-radius: 10px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.5);
    backdrop-filter: blur(12px);
    z-index: 30;
  }
  #autocomplete.show { display: block; }

  .ac-item {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.15s;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .ac-item:last-child { border-bottom: none; }
  .ac-item:hover, .ac-item.active { background: rgba(96,165,250,0.15); }
  .ac-item .ac-flag { font-size: 20px; }
  .ac-item .ac-code {
    font-weight: 700;
    font-size: 13px;
    color: #60a5fa;
    width: 28px;
    letter-spacing: 1px;
  }
  .ac-item .ac-name { font-size: 13px; color: #e2e8f0; }
  .ac-item .ac-cn { font-size: 12px; color: #94a3b8; margin-left: 4px; }

  #map-container {
    width: 100%;
    height: calc(100vh - 82px);
    position: relative;
    cursor: grab;
  }
  #map-container:active { cursor: grabbing; }

  #map-svg {
    width: 100%;
    height: 100%;
  }

  .country-path {
    stroke: #1a2540;
    stroke-width: 0.4;
    cursor: pointer;
    transition: filter 0.15s;
  }

  .country-path:hover {
    filter: brightness(1.35) drop-shadow(0 0 6px rgba(255,255,255,0.25));
  }

  .country-path.dimmed {
    opacity: 0.15;
    filter: saturate(0.3);
  }

  .country-path.search-focus {
    filter: brightness(1.4) drop-shadow(0 0 14px rgba(251,191,36,0.6));
    stroke: #fbbf24;
    stroke-width: 2;
  }

  .country-label {
    font-size: 6.5px;
    fill: #fff;
    text-anchor: middle;
    pointer-events: none;
    font-weight: 600;
    opacity: 0.85;
    paint-order: stroke;
    stroke: rgba(0,0,0,0.6);
    stroke-width: 2px;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .country-label.label-lg { font-size: 8px; }
  .country-label.label-sm { font-size: 5px; opacity: 0.7; }
  .country-label.dimmed { opacity: 0.08; }

  /* Tooltip */
  #tooltip {
    display: none;
    position: fixed;
    background: rgba(15,23,42,0.95);
    border: 1px solid rgba(96,165,250,0.3);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    pointer-events: none;
    z-index: 50;
    backdrop-filter: blur(6px);
    max-width: 220px;
  }
  #tooltip .tt-name { font-weight: 700; color: #f1f5f9; }
  #tooltip .tt-cn { color: #94a3b8; font-size: 11px; }

  /* ===== Bottom detail panel (replaces modal for search) ===== */
  #detail-panel {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: linear-gradient(180deg, rgba(15,23,42,0.0) 0%, rgba(15,23,42,0.97) 12%, rgba(15,23,42,0.99) 100%);
    backdrop-filter: blur(16px);
    z-index: 80;
    transform: translateY(100%);
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    padding: 30px 0 0;
  }
  #detail-panel.active {
    transform: translateY(0);
  }

  #detail-inner {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 28px 22px;
    display: flex;
    align-items: center;
    gap: 24px;
  }

  #detail-flag {
    font-size: 52px;
    line-height: 1;
    flex-shrink: 0;
    animation: popIn 0.5s 0.3s both;
  }

  @keyframes popIn {
    from { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.2); }
    to { transform: scale(1); opacity: 1; }
  }

  #detail-names {
    flex-shrink: 0;
    min-width: 160px;
  }
  #detail-name-en {
    font-size: 26px;
    font-weight: 700;
    color: #f1f5f9;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: color 0.2s;
  }
  #detail-name-en:hover { color: #60a5fa; }
  #detail-name-en .speak-icon {
    font-size: 18px;
    opacity: 0;
    transition: opacity 0.2s;
  }
  #detail-name-en:hover .speak-icon { opacity: 1; }
  #detail-name-cn {
    font-size: 17px;
    color: #94a3b8;
    margin-top: 2px;
  }

  #detail-stats {
    display: flex;
    gap: 16px;
    flex: 1;
    flex-wrap: wrap;
  }

  .stat-card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 10px 16px;
    min-width: 130px;
    flex: 1;
    opacity: 0;
    transform: translateY(20px);
    animation: statIn 0.4s ease both;
  }
  .stat-card:nth-child(1) { animation-delay: 0.15s; }
  .stat-card:nth-child(2) { animation-delay: 0.25s; }
  .stat-card:nth-child(3) { animation-delay: 0.35s; }
  .stat-card:nth-child(4) { animation-delay: 0.45s; }
  .stat-card:nth-child(5) { animation-delay: 0.55s; }

  @keyframes statIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .stat-card .stat-icon { font-size: 16px; }
  .stat-card .stat-label {
    font-size: 9px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-top: 2px;
  }
  .stat-card .stat-value {
    font-size: 15px;
    font-weight: 600;
    color: #e2e8f0;
    margin-top: 2px;
  }
  .stat-card .stat-sub {
    font-size: 11px;
    color: #94a3b8;
  }

  #cancel-btn {
    background: rgba(239,68,68,0.15);
    border: 1px solid rgba(239,68,68,0.3);
    color: #f87171;
    padding: 10px 22px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #cancel-btn:hover {
    background: rgba(239,68,68,0.25);
    border-color: rgba(239,68,68,0.5);
    transform: translateY(-1px);
  }
  #cancel-btn:active { transform: scale(0.97); }

  /* ===== Click modal (kept for direct click on map) ===== */
  #modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    z-index: 100;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
  }
  #modal-overlay.active { display: flex; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp {
    from { transform: translateY(40px) scale(0.95); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
  }
  @keyframes zoomState {
    from { transform: scale(0.3); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  #modal-content {
    background: linear-gradient(145deg, #1e293b, #0f172a);
    border: 1px solid rgba(96,165,250,0.3);
    border-radius: 20px;
    width: 700px;
    max-width: 94vw;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.4s ease;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 40px rgba(96,165,250,0.1);
  }

  #modal-header {
    padding: 24px 28px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  #modal-flag { font-size: 48px; line-height: 1; margin-right: 14px; }
  #modal-names { flex: 1; }
  #modal-country-name { font-size: 30px; font-weight: 700; color: #f1f5f9; }
  #modal-country-cn { font-size: 19px; color: #94a3b8; margin-top: 1px; }

  #modal-close {
    background: rgba(255,255,255,0.08);
    border: none;
    color: #94a3b8;
    font-size: 22px;
    cursor: pointer;
    border-radius: 50%;
    width: 38px; height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  #modal-close:hover { background: rgba(239,68,68,0.2); color: #ef4444; }

  #modal-body {
    display: flex;
    padding: 20px 28px 28px;
    gap: 24px;
  }

  #country-shape-container {
    flex: 0 0 210px;
    height: 190px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.03);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.06);
  }

  #country-shape-svg { width: 190px; height: 170px; }
  #country-shape-svg .zoomed-country { animation: zoomState 0.5s ease; }

  #country-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .info-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 9px 14px;
    background: rgba(255,255,255,0.04);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.05);
  }

  .info-icon { font-size: 20px; width: 34px; text-align: center; flex-shrink: 0; }
  .info-label {
    font-size: 10px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .info-value { font-size: 15px; font-weight: 600; color: #e2e8f0; }
  .info-value-sub { font-size: 12px; color: #94a3b8; font-weight: 400; }

  #speak-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, #3b82f6, #6366f1);
    border: none;
    color: #fff;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
    margin-top: 4px;
    align-self: flex-start;
  }
  #speak-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(99,102,241,0.4); }
  #speak-btn:active { transform: scale(0.97); }

  /* Pulse ring on focused country */
  .pulse-ring {
    fill: none;
    stroke: #fbbf24;
    stroke-width: 2;
    opacity: 0;
    animation: pulseRing 2s ease-in-out infinite;
  }
  @keyframes pulseRing {
    0% { r: 0; opacity: 0.8; stroke-width: 3; }
    100% { r: 50; opacity: 0; stroke-width: 0.5; }
  }

  @media (max-width: 800px) {
    #detail-inner { flex-wrap: wrap; gap: 12px; }
    #detail-stats { gap: 8px; }
    .stat-card { min-width: 100px; padding: 8px 12px; }
    #modal-body { flex-direction: column; }
    #country-shape-container { flex: none; width: 100%; height: 140px; }
  }
</style>
</head>
<body>

<div id="header">
  <h1>ğŸŒ World Map Puzzle ä¸–ç•Œåœ°å›¾æ‹¼å›¾</h1>
  <p>è¾“å…¥ä¸¤ä½å›½å®¶ä»£ç æœç´¢ Â· ç‚¹å‡»ä»»æ„å›½å®¶æŸ¥çœ‹è¯¦æƒ… Â· æ»šè½®ç¼©æ”¾ Â· æ‹–æ‹½å¹³ç§»</p>
</div>
<div id="controls">
  <input id="search-box" type="text" maxlength="2" placeholder="è¾“å…¥å›½å®¶ä»£ç  (å¦‚ CN, US, JP)..." autocomplete="off"/>
  <button id="search-btn" disabled>ğŸ” æœç´¢</button>
  <span id="search-hint">è¾“å…¥2ä½å­—æ¯ä»£ç </span>
  <div id="autocomplete"></div>
</div>

<div id="map-container">
  <svg id="map-svg"></svg>
</div>

<div id="tooltip">
  <div class="tt-name" id="tt-name"></div>
  <div class="tt-cn" id="tt-cn"></div>
</div>

<!-- Bottom detail panel for search -->
<div id="detail-panel">
  <div id="detail-inner">
    <div id="detail-flag"></div>
    <div id="detail-names">
      <div id="detail-name-en"><span id="detail-en-text"></span><span class="speak-icon">ğŸ”Š</span></div>
      <div id="detail-name-cn"></div>
    </div>
    <div id="detail-stats"></div>
    <button id="cancel-btn">âœ• å–æ¶ˆè¿”å›</button>
  </div>
</div>

<!-- Modal overlay for direct click -->
<div id="modal-overlay">
  <div id="modal-content">
    <div id="modal-header">
      <div style="display:flex;align-items:center;">
        <div id="modal-flag"></div>
        <div id="modal-names">
          <div id="modal-country-name"></div>
          <div id="modal-country-cn"></div>
        </div>
      </div>
      <button id="modal-close" title="å…³é—­">&times;</button>
    </div>
    <div id="modal-body">
      <div id="country-shape-container">
        <svg id="country-shape-svg" viewBox="0 0 200 200"></svg>
      </div>
      <div id="country-info">
        <div class="info-row">
          <div class="info-icon">ğŸ›ï¸</div>
          <div>
            <div class="info-label">Capital é¦–éƒ½</div>
            <div class="info-value" id="info-capital"></div>
            <div class="info-value-sub" id="info-capital-cn"></div>
          </div>
        </div>
        <div class="info-row">
          <div class="info-icon">ğŸ‘¥</div>
          <div>
            <div class="info-label">Population äººå£</div>
            <div class="info-value" id="info-population"></div>
          </div>
        </div>
        <div class="info-row">
          <div class="info-icon">ğŸ’°</div>
          <div>
            <div class="info-label">GDP Per Capita äººå‡GDP</div>
            <div class="info-value" id="info-gdp"></div>
          </div>
        </div>
        <div class="info-row">
          <div class="info-icon">ğŸŒ</div>
          <div>
            <div class="info-label">ISO Code å›½å®¶ä»£ç </div>
            <div class="info-value" id="info-code"></div>
          </div>
        </div>
        <div class="info-row">
          <div class="info-icon">ğŸ“</div>
          <div>
            <div class="info-label">Continent æ‰€å±æ´²</div>
            <div class="info-value" id="info-continent"></div>
          </div>
        </div>
        <button id="speak-btn">ğŸ”Š Hear Pronunciation</button>
      </div>
    </div>
  </div>
</div>

<script>
// =====================================================
//  COUNTRY DATA
// =====================================================
const countries = {
  "004":{a2:"AF",name:"Afghanistan",cn:"é˜¿å¯Œæ±—",capital:"Kabul",capitalCn:"å–€å¸ƒå°”",pop:41128771,gdp:364,cont:"Asia äºšæ´²",flag:"ğŸ‡¦ğŸ‡«"},
  "008":{a2:"AL",name:"Albania",cn:"é˜¿å°”å·´å°¼äºš",capital:"Tirana",capitalCn:"åœ°æ‹‰é‚£",pop:2877797,gdp:6810,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¦ğŸ‡±"},
  "012":{a2:"DZ",name:"Algeria",cn:"é˜¿å°”åŠåˆ©äºš",capital:"Algiers",capitalCn:"é˜¿å°”åŠå°”",pop:44903225,gdp:3765,cont:"Africa éæ´²",flag:"ğŸ‡©ğŸ‡¿"},
  "024":{a2:"AO",name:"Angola",cn:"å®‰å“¥æ‹‰",capital:"Luanda",capitalCn:"ç½—å®‰è¾¾",pop:34503774,gdp:1953,cont:"Africa éæ´²",flag:"ğŸ‡¦ğŸ‡´"},
  "032":{a2:"AR",name:"Argentina",cn:"é˜¿æ ¹å»·",capital:"Buenos Aires",capitalCn:"å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯",pop:45808747,gdp:13709,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡¦ğŸ‡·"},
  "051":{a2:"AM",name:"Armenia",cn:"äºšç¾å°¼äºš",capital:"Yerevan",capitalCn:"åŸƒé‡Œæ¸©",pop:2963243,gdp:7034,cont:"Asia äºšæ´²",flag:"ğŸ‡¦ğŸ‡²"},
  "036":{a2:"AU",name:"Australia",cn:"æ¾³å¤§åˆ©äºš",capital:"Canberra",capitalCn:"å ªåŸ¹æ‹‰",pop:26439111,gdp:65099,cont:"Oceania å¤§æ´‹æ´²",flag:"ğŸ‡¦ğŸ‡º"},
  "040":{a2:"AT",name:"Austria",cn:"å¥¥åœ°åˆ©",capital:"Vienna",capitalCn:"ç»´ä¹Ÿçº³",pop:9104772,gdp:56802,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¦ğŸ‡¹"},
  "031":{a2:"AZ",name:"Azerbaijan",cn:"é˜¿å¡æ‹œç–†",capital:"Baku",capitalCn:"å·´åº“",pop:10145212,gdp:7760,cont:"Asia äºšæ´²",flag:"ğŸ‡¦ğŸ‡¿"},
  "050":{a2:"BD",name:"Bangladesh",cn:"å­ŸåŠ æ‹‰å›½",capital:"Dhaka",capitalCn:"è¾¾å¡",pop:171186372,gdp:2688,cont:"Asia äºšæ´²",flag:"ğŸ‡§ğŸ‡©"},
  "112":{a2:"BY",name:"Belarus",cn:"ç™½ä¿„ç½—æ–¯",capital:"Minsk",capitalCn:"æ˜æ–¯å…‹",pop:9498238,gdp:7888,cont:"Europe æ¬§æ´²",flag:"ğŸ‡§ğŸ‡¾"},
  "056":{a2:"BE",name:"Belgium",cn:"æ¯”åˆ©æ—¶",capital:"Brussels",capitalCn:"å¸ƒé²å¡å°”",pop:11686140,gdp:51767,cont:"Europe æ¬§æ´²",flag:"ğŸ‡§ğŸ‡ª"},
  "084":{a2:"BZ",name:"Belize",cn:"ä¼¯åˆ©å…¹",capital:"Belmopan",capitalCn:"è´å°”è«æ½˜",pop:405272,gdp:6165,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡§ğŸ‡¿"},
  "204":{a2:"BJ",name:"Benin",cn:"è´å®",capital:"Porto-Novo",capitalCn:"æ³¢å¤šè¯ºä¼",pop:13352864,gdp:1399,cont:"Africa éæ´²",flag:"ğŸ‡§ğŸ‡¯"},
  "064":{a2:"BT",name:"Bhutan",cn:"ä¸ä¸¹",capital:"Thimphu",capitalCn:"å»·å¸ƒ",pop:787424,gdp:3560,cont:"Asia äºšæ´²",flag:"ğŸ‡§ğŸ‡¹"},
  "068":{a2:"BO",name:"Bolivia",cn:"ç»åˆ©ç»´äºš",capital:"Sucre",capitalCn:"è‹å…‹é›·",pop:12054379,gdp:3600,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡§ğŸ‡´"},
  "070":{a2:"BA",name:"Bosnia and Herzegovina",cn:"æ³¢é»‘",capital:"Sarajevo",capitalCn:"è¨æ‹‰çƒ­çª",pop:3233526,gdp:7580,cont:"Europe æ¬§æ´²",flag:"ğŸ‡§ğŸ‡¦"},
  "072":{a2:"BW",name:"Botswana",cn:"åšèŒ¨ç“¦çº³",capital:"Gaborone",capitalCn:"å“ˆåšç½—å†…",pop:2397241,gdp:7738,cont:"Africa éæ´²",flag:"ğŸ‡§ğŸ‡¼"},
  "076":{a2:"BR",name:"Brazil",cn:"å·´è¥¿",capital:"BrasÃ­lia",capitalCn:"å·´è¥¿åˆ©äºš",pop:215313498,gdp:8917,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡§ğŸ‡·"},
  "096":{a2:"BN",name:"Brunei",cn:"æ–‡è±",capital:"Bandar Seri Begawan",capitalCn:"æ–¯é‡Œå·´åŠ æ¹¾å¸‚",pop:449002,gdp:37485,cont:"Asia äºšæ´²",flag:"ğŸ‡§ğŸ‡³"},
  "100":{a2:"BG",name:"Bulgaria",cn:"ä¿åŠ åˆ©äºš",capital:"Sofia",capitalCn:"ç´¢éäºš",pop:6878000,gdp:13772,cont:"Europe æ¬§æ´²",flag:"ğŸ‡§ğŸ‡¬"},
  "854":{a2:"BF",name:"Burkina Faso",cn:"å¸ƒåŸºçº³æ³•ç´¢",capital:"Ouagadougou",capitalCn:"ç“¦åŠ æœå¤",pop:22100683,gdp:831,cont:"Africa éæ´²",flag:"ğŸ‡§ğŸ‡«"},
  "108":{a2:"BI",name:"Burundi",cn:"å¸ƒéš†è¿ª",capital:"Gitega",capitalCn:"åŸºç‰¹åŠ ",pop:12551213,gdp:238,cont:"Africa éæ´²",flag:"ğŸ‡§ğŸ‡®"},
  "116":{a2:"KH",name:"Cambodia",cn:"æŸ¬åŸ”å¯¨",capital:"Phnom Penh",capitalCn:"é‡‘è¾¹",pop:16767842,gdp:1785,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡­"},
  "120":{a2:"CM",name:"Cameroon",cn:"å–€éº¦éš†",capital:"YaoundÃ©",capitalCn:"é›…æ¸©å¾—",pop:27914536,gdp:1662,cont:"Africa éæ´²",flag:"ğŸ‡¨ğŸ‡²"},
  "124":{a2:"CA",name:"Canada",cn:"åŠ æ‹¿å¤§",capital:"Ottawa",capitalCn:"æ¸¥å¤ªå",pop:39858480,gdp:52791,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¨ğŸ‡¦"},
  "140":{a2:"CF",name:"Central African Republic",cn:"ä¸­éå…±å’Œå›½",capital:"Bangui",capitalCn:"ç­å‰",pop:5742315,gdp:480,cont:"Africa éæ´²",flag:"ğŸ‡¨ğŸ‡«"},
  "148":{a2:"TD",name:"Chad",cn:"ä¹å¾—",capital:"N'Djamena",capitalCn:"æ©è´¾æ¢…çº³",pop:17723315,gdp:695,cont:"Africa éæ´²",flag:"ğŸ‡¹ğŸ‡©"},
  "152":{a2:"CL",name:"Chile",cn:"æ™ºåˆ©",capital:"Santiago",capitalCn:"åœ£åœ°äºšå“¥",pop:19491616,gdp:16265,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡¨ğŸ‡±"},
  "156":{a2:"CN",name:"China",cn:"ä¸­å›½",capital:"Beijing",capitalCn:"åŒ—äº¬",pop:1425671352,gdp:12720,cont:"Asia äºšæ´²",flag:"ğŸ‡¨ğŸ‡³"},
  "170":{a2:"CO",name:"Colombia",cn:"å“¥ä¼¦æ¯”äºš",capital:"BogotÃ¡",capitalCn:"æ³¢å“¥å¤§",pop:51874024,gdp:6630,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡¨ğŸ‡´"},
  "178":{a2:"CG",name:"Congo",cn:"åˆšæœï¼ˆå¸ƒï¼‰",capital:"Brazzaville",capitalCn:"å¸ƒæ‹‰æŸ´ç»´å°”",pop:5970424,gdp:2280,cont:"Africa éæ´²",flag:"ğŸ‡¨ğŸ‡¬"},
  "180":{a2:"CD",name:"DR Congo",cn:"åˆšæœï¼ˆé‡‘ï¼‰",capital:"Kinshasa",capitalCn:"é‡‘æ²™è¨",pop:99010212,gdp:577,cont:"Africa éæ´²",flag:"ğŸ‡¨ğŸ‡©"},
  "188":{a2:"CR",name:"Costa Rica",cn:"å“¥æ–¯è¾¾é»åŠ ",capital:"San JosÃ©",capitalCn:"åœ£ä½•å¡",pop:5180829,gdp:12509,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¨ğŸ‡·"},
  "384":{a2:"CI",name:"CÃ´te d'Ivoire",cn:"ç§‘ç‰¹è¿ªç“¦",capital:"Yamoussoukro",capitalCn:"äºšç©†è‹å…‹ç½—",pop:28160542,gdp:2549,cont:"Africa éæ´²",flag:"ğŸ‡¨ğŸ‡®"},
  "191":{a2:"HR",name:"Croatia",cn:"å…‹ç½—åœ°äºš",capital:"Zagreb",capitalCn:"è¨æ ¼å‹’å¸ƒ",pop:3871833,gdp:18398,cont:"Europe æ¬§æ´²",flag:"ğŸ‡­ğŸ‡·"},
  "192":{a2:"CU",name:"Cuba",cn:"å¤å·´",capital:"Havana",capitalCn:"å“ˆç“¦é‚£",pop:11212191,gdp:9500,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¨ğŸ‡º"},
  "196":{a2:"CY",name:"Cyprus",cn:"å¡æµ¦è·¯æ–¯",capital:"Nicosia",capitalCn:"å°¼ç§‘è¥¿äºš",pop:1251488,gdp:31551,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¨ğŸ‡¾"},
  "203":{a2:"CZ",name:"Czech Republic",cn:"æ·å…‹",capital:"Prague",capitalCn:"å¸ƒæ‹‰æ ¼",pop:10827529,gdp:27220,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¨ğŸ‡¿"},
  "208":{a2:"DK",name:"Denmark",cn:"ä¸¹éº¦",capital:"Copenhagen",capitalCn:"å“¥æœ¬å“ˆæ ¹",pop:5882261,gdp:67803,cont:"Europe æ¬§æ´²",flag:"ğŸ‡©ğŸ‡°"},
  "262":{a2:"DJ",name:"Djibouti",cn:"å‰å¸ƒæ",capital:"Djibouti",capitalCn:"å‰å¸ƒæ",pop:1120849,gdp:3414,cont:"Africa éæ´²",flag:"ğŸ‡©ğŸ‡¯"},
  "214":{a2:"DO",name:"Dominican Republic",cn:"å¤šç±³å°¼åŠ ",capital:"Santo Domingo",capitalCn:"åœ£å¤šæ˜å„",pop:11228821,gdp:10121,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡©ğŸ‡´"},
  "218":{a2:"EC",name:"Ecuador",cn:"å„ç“œå¤šå°”",capital:"Quito",capitalCn:"åŸºå¤š",pop:18001000,gdp:6282,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡ªğŸ‡¨"},
  "818":{a2:"EG",name:"Egypt",cn:"åŸƒåŠ",capital:"Cairo",capitalCn:"å¼€ç½—",pop:110990103,gdp:3699,cont:"Africa éæ´²",flag:"ğŸ‡ªğŸ‡¬"},
  "222":{a2:"SV",name:"El Salvador",cn:"è¨å°”ç“¦å¤š",capital:"San Salvador",capitalCn:"åœ£è¨å°”ç“¦å¤š",pop:6314167,gdp:4988,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¸ğŸ‡»"},
  "226":{a2:"GQ",name:"Equatorial Guinea",cn:"èµ¤é“å‡ å†…äºš",capital:"Malabo",capitalCn:"é©¬æ‹‰åš",pop:1674908,gdp:8132,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡¶"},
  "232":{a2:"ER",name:"Eritrea",cn:"å„ç«‹ç‰¹é‡Œäºš",capital:"Asmara",capitalCn:"é˜¿æ–¯é©¬æ‹‰",pop:3748901,gdp:642,cont:"Africa éæ´²",flag:"ğŸ‡ªğŸ‡·"},
  "233":{a2:"EE",name:"Estonia",cn:"çˆ±æ²™å°¼äºš",capital:"Tallinn",capitalCn:"å¡”æ—",pop:1322765,gdp:28247,cont:"Europe æ¬§æ´²",flag:"ğŸ‡ªğŸ‡ª"},
  "748":{a2:"SZ",name:"Eswatini",cn:"æ–¯å¨å£«å…°",capital:"Mbabane",capitalCn:"å§†å·´å·´å†…",pop:1192271,gdp:3987,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡¿"},
  "231":{a2:"ET",name:"Ethiopia",cn:"åŸƒå¡ä¿„æ¯”äºš",capital:"Addis Ababa",capitalCn:"äºšçš„æ–¯äºšè´å·´",pop:126527060,gdp:1027,cont:"Africa éæ´²",flag:"ğŸ‡ªğŸ‡¹"},
  "246":{a2:"FI",name:"Finland",cn:"èŠ¬å…°",capital:"Helsinki",capitalCn:"èµ«å°”è¾›åŸº",pop:5541274,gdp:53655,cont:"Europe æ¬§æ´²",flag:"ğŸ‡«ğŸ‡®"},
  "250":{a2:"FR",name:"France",cn:"æ³•å›½",capital:"Paris",capitalCn:"å·´é»",pop:67935660,gdp:44408,cont:"Europe æ¬§æ´²",flag:"ğŸ‡«ğŸ‡·"},
  "266":{a2:"GA",name:"Gabon",cn:"åŠ è“¬",capital:"Libreville",capitalCn:"åˆ©ä¼¯ç»´å°”",pop:2388992,gdp:8820,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡¦"},
  "270":{a2:"GM",name:"Gambia",cn:"å†ˆæ¯”äºš",capital:"Banjul",capitalCn:"ç­ç å°”",pop:2639916,gdp:840,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡²"},
  "268":{a2:"GE",name:"Georgia",cn:"æ ¼é²å‰äºš",capital:"Tbilisi",capitalCn:"ç¬¬æ¯”åˆ©æ–¯",pop:3728573,gdp:6671,cont:"Asia äºšæ´²",flag:"ğŸ‡¬ğŸ‡ª"},
  "276":{a2:"DE",name:"Germany",cn:"å¾·å›½",capital:"Berlin",capitalCn:"æŸæ—",pop:83294633,gdp:51383,cont:"Europe æ¬§æ´²",flag:"ğŸ‡©ğŸ‡ª"},
  "288":{a2:"GH",name:"Ghana",cn:"åŠ çº³",capital:"Accra",capitalCn:"é˜¿å…‹æ‹‰",pop:33475870,gdp:2363,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡­"},
  "300":{a2:"GR",name:"Greece",cn:"å¸Œè…Š",capital:"Athens",capitalCn:"é›…å…¸",pop:10384971,gdp:20867,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¬ğŸ‡·"},
  "320":{a2:"GT",name:"Guatemala",cn:"å±åœ°é©¬æ‹‰",capital:"Guatemala City",capitalCn:"å±åœ°é©¬æ‹‰åŸ",pop:17602431,gdp:5474,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¬ğŸ‡¹"},
  "324":{a2:"GN",name:"Guinea",cn:"å‡ å†…äºš",capital:"Conakry",capitalCn:"ç§‘çº³å…‹é‡Œ",pop:13859341,gdp:1194,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡³"},
  "624":{a2:"GW",name:"Guinea-Bissau",cn:"å‡ å†…äºšæ¯”ç»",capital:"Bissau",capitalCn:"æ¯”ç»",pop:2105566,gdp:775,cont:"Africa éæ´²",flag:"ğŸ‡¬ğŸ‡¼"},
  "328":{a2:"GY",name:"Guyana",cn:"åœ­äºšé‚£",capital:"Georgetown",capitalCn:"ä¹”æ²»æ•¦",pop:808726,gdp:17399,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡¬ğŸ‡¾"},
  "332":{a2:"HT",name:"Haiti",cn:"æµ·åœ°",capital:"Port-au-Prince",capitalCn:"å¤ªå­æ¸¯",pop:11584996,gdp:1272,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡­ğŸ‡¹"},
  "340":{a2:"HN",name:"Honduras",cn:"æ´ªéƒ½æ‹‰æ–¯",capital:"Tegucigalpa",capitalCn:"ç‰¹å¤è¥¿åŠ å°”å·´",pop:10278345,gdp:2831,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡­ğŸ‡³"},
  "348":{a2:"HU",name:"Hungary",cn:"åŒˆç‰™åˆ©",capital:"Budapest",capitalCn:"å¸ƒè¾¾ä½©æ–¯",pop:9750149,gdp:18728,cont:"Europe æ¬§æ´²",flag:"ğŸ‡­ğŸ‡º"},
  "352":{a2:"IS",name:"Iceland",cn:"å†°å²›",capital:"Reykjavik",capitalCn:"é›·å…‹é›…ç»´å…‹",pop:376248,gdp:73981,cont:"Europe æ¬§æ´²",flag:"ğŸ‡®ğŸ‡¸"},
  "356":{a2:"IN",name:"India",cn:"å°åº¦",capital:"New Delhi",capitalCn:"æ–°å¾·é‡Œ",pop:1428627663,gdp:2485,cont:"Asia äºšæ´²",flag:"ğŸ‡®ğŸ‡³"},
  "360":{a2:"ID",name:"Indonesia",cn:"å°åº¦å°¼è¥¿äºš",capital:"Jakarta",capitalCn:"é›…åŠ è¾¾",pop:277534122,gdp:4788,cont:"Asia äºšæ´²",flag:"ğŸ‡®ğŸ‡©"},
  "364":{a2:"IR",name:"Iran",cn:"ä¼Šæœ—",capital:"Tehran",capitalCn:"å¾·é»‘å…°",pop:88550570,gdp:4091,cont:"Asia äºšæ´²",flag:"ğŸ‡®ğŸ‡·"},
  "368":{a2:"IQ",name:"Iraq",cn:"ä¼Šæ‹‰å…‹",capital:"Baghdad",capitalCn:"å·´æ ¼è¾¾",pop:43533592,gdp:5048,cont:"Asia äºšæ´²",flag:"ğŸ‡®ğŸ‡¶"},
  "372":{a2:"IE",name:"Ireland",cn:"çˆ±å°”å…°",capital:"Dublin",capitalCn:"éƒ½æŸæ—",pop:5056935,gdp:100172,cont:"Europe æ¬§æ´²",flag:"ğŸ‡®ğŸ‡ª"},
  "376":{a2:"IL",name:"Israel",cn:"ä»¥è‰²åˆ—",capital:"Jerusalem",capitalCn:"è€¶è·¯æ’’å†·",pop:9174520,gdp:52170,cont:"Asia äºšæ´²",flag:"ğŸ‡®ğŸ‡±"},
  "380":{a2:"IT",name:"Italy",cn:"æ„å¤§åˆ©",capital:"Rome",capitalCn:"ç½—é©¬",pop:59037474,gdp:34776,cont:"Europe æ¬§æ´²",flag:"ğŸ‡®ğŸ‡¹"},
  "388":{a2:"JM",name:"Jamaica",cn:"ç‰™ä¹°åŠ ",capital:"Kingston",capitalCn:"é‡‘æ–¯æ•¦",pop:2827695,gdp:5761,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¯ğŸ‡²"},
  "392":{a2:"JP",name:"Japan",cn:"æ—¥æœ¬",capital:"Tokyo",capitalCn:"ä¸œäº¬",pop:125124989,gdp:33815,cont:"Asia äºšæ´²",flag:"ğŸ‡¯ğŸ‡µ"},
  "400":{a2:"JO",name:"Jordan",cn:"çº¦æ—¦",capital:"Amman",capitalCn:"å®‰æ›¼",pop:11285869,gdp:4103,cont:"Asia äºšæ´²",flag:"ğŸ‡¯ğŸ‡´"},
  "398":{a2:"KZ",name:"Kazakhstan",cn:"å“ˆè¨å…‹æ–¯å¦",capital:"Astana",capitalCn:"é˜¿æ–¯å¡”çº³",pop:19606633,gdp:11477,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡¿"},
  "404":{a2:"KE",name:"Kenya",cn:"è‚¯å°¼äºš",capital:"Nairobi",capitalCn:"å†…ç½—æ¯•",pop:54027487,gdp:2099,cont:"Africa éæ´²",flag:"ğŸ‡°ğŸ‡ª"},
  "408":{a2:"KP",name:"North Korea",cn:"æœé²œ",capital:"Pyongyang",capitalCn:"å¹³å£¤",pop:26069416,gdp:640,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡µ"},
  "410":{a2:"KR",name:"South Korea",cn:"éŸ©å›½",capital:"Seoul",capitalCn:"é¦–å°”",pop:51784059,gdp:32423,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡·"},
  "414":{a2:"KW",name:"Kuwait",cn:"ç§‘å¨ç‰¹",capital:"Kuwait City",capitalCn:"ç§‘å¨ç‰¹åŸ",pop:4268873,gdp:33036,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡¼"},
  "417":{a2:"KG",name:"Kyrgyzstan",cn:"å‰å°”å‰æ–¯æ–¯å¦",capital:"Bishkek",capitalCn:"æ¯”ä»€å‡¯å…‹",pop:6974900,gdp:1376,cont:"Asia äºšæ´²",flag:"ğŸ‡°ğŸ‡¬"},
  "418":{a2:"LA",name:"Laos",cn:"è€æŒ",capital:"Vientiane",capitalCn:"ä¸‡è±¡",pop:7529475,gdp:2054,cont:"Asia äºšæ´²",flag:"ğŸ‡±ğŸ‡¦"},
  "428":{a2:"LV",name:"Latvia",cn:"æ‹‰è„±ç»´äºš",capital:"Riga",capitalCn:"é‡ŒåŠ ",pop:1842226,gdp:21148,cont:"Europe æ¬§æ´²",flag:"ğŸ‡±ğŸ‡»"},
  "422":{a2:"LB",name:"Lebanon",cn:"é»å·´å«©",capital:"Beirut",capitalCn:"è´é²ç‰¹",pop:5490000,gdp:4891,cont:"Asia äºšæ´²",flag:"ğŸ‡±ğŸ‡§"},
  "426":{a2:"LS",name:"Lesotho",cn:"è±ç´¢æ‰˜",capital:"Maseru",capitalCn:"é©¬å¡å¢",pop:2281454,gdp:1093,cont:"Africa éæ´²",flag:"ğŸ‡±ğŸ‡¸"},
  "430":{a2:"LR",name:"Liberia",cn:"åˆ©æ¯”é‡Œäºš",capital:"Monrovia",capitalCn:"è’™ç½—ç»´äºš",pop:5302681,gdp:621,cont:"Africa éæ´²",flag:"ğŸ‡±ğŸ‡·"},
  "434":{a2:"LY",name:"Libya",cn:"åˆ©æ¯”äºš",capital:"Tripoli",capitalCn:"çš„é»æ³¢é‡Œ",pop:6888388,gdp:6357,cont:"Africa éæ´²",flag:"ğŸ‡±ğŸ‡¾"},
  "440":{a2:"LT",name:"Lithuania",cn:"ç«‹é™¶å®›",capital:"Vilnius",capitalCn:"ç»´å°”çº½æ–¯",pop:2857279,gdp:24032,cont:"Europe æ¬§æ´²",flag:"ğŸ‡±ğŸ‡¹"},
  "442":{a2:"LU",name:"Luxembourg",cn:"å¢æ£®å ¡",capital:"Luxembourg",capitalCn:"å¢æ£®å ¡",pop:660809,gdp:126598,cont:"Europe æ¬§æ´²",flag:"ğŸ‡±ğŸ‡º"},
  "450":{a2:"MG",name:"Madagascar",cn:"é©¬è¾¾åŠ æ–¯åŠ ",capital:"Antananarivo",capitalCn:"å¡”é‚£é‚£åˆ©ä½›",pop:29611714,gdp:523,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡¬"},
  "454":{a2:"MW",name:"Malawi",cn:"é©¬æ‹‰ç»´",capital:"Lilongwe",capitalCn:"åˆ©éš†åœ­",pop:20405317,gdp:645,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡¼"},
  "458":{a2:"MY",name:"Malaysia",cn:"é©¬æ¥è¥¿äºš",capital:"Kuala Lumpur",capitalCn:"å‰éš†å¡",pop:33938221,gdp:12570,cont:"Asia äºšæ´²",flag:"ğŸ‡²ğŸ‡¾"},
  "466":{a2:"ML",name:"Mali",cn:"é©¬é‡Œ",capital:"Bamako",capitalCn:"å·´é©¬ç§‘",pop:22593590,gdp:833,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡±"},
  "478":{a2:"MR",name:"Mauritania",cn:"æ¯›é‡Œå¡”å°¼äºš",capital:"Nouakchott",capitalCn:"åŠªç“¦å…‹è‚–ç‰¹",pop:4614974,gdp:2166,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡·"},
  "484":{a2:"MX",name:"Mexico",cn:"å¢¨è¥¿å“¥",capital:"Mexico City",capitalCn:"å¢¨è¥¿å“¥åŸ",pop:128901000,gdp:10948,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡²ğŸ‡½"},
  "498":{a2:"MD",name:"Moldova",cn:"æ‘©å°”å¤šç“¦",capital:"ChiÈ™inÄƒu",capitalCn:"åŸºå¸Œè®·ä¹Œ",pop:2597100,gdp:5563,cont:"Europe æ¬§æ´²",flag:"ğŸ‡²ğŸ‡©"},
  "496":{a2:"MN",name:"Mongolia",cn:"è’™å¤",capital:"Ulaanbaatar",capitalCn:"ä¹Œå…°å·´æ‰˜",pop:3398366,gdp:4965,cont:"Asia äºšæ´²",flag:"ğŸ‡²ğŸ‡³"},
  "499":{a2:"ME",name:"Montenegro",cn:"é»‘å±±",capital:"Podgorica",capitalCn:"æ³¢å¾·æˆˆé‡Œå¯Ÿ",pop:621306,gdp:10143,cont:"Europe æ¬§æ´²",flag:"ğŸ‡²ğŸ‡ª"},
  "504":{a2:"MA",name:"Morocco",cn:"æ‘©æ´›å“¥",capital:"Rabat",capitalCn:"æ‹‰å·´ç‰¹",pop:37457971,gdp:3527,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡¦"},
  "508":{a2:"MZ",name:"Mozambique",cn:"è«æ¡‘æ¯”å…‹",capital:"Maputo",capitalCn:"é©¬æ™®æ‰˜",pop:33897354,gdp:539,cont:"Africa éæ´²",flag:"ğŸ‡²ğŸ‡¿"},
  "104":{a2:"MM",name:"Myanmar",cn:"ç¼…ç”¸",capital:"Naypyidaw",capitalCn:"å†…æ¯”éƒ½",pop:54179306,gdp:1095,cont:"Asia äºšæ´²",flag:"ğŸ‡²ğŸ‡²"},
  "516":{a2:"NA",name:"Namibia",cn:"çº³ç±³æ¯”äºš",capital:"Windhoek",capitalCn:"æ¸©å¾—å’Œå…‹",pop:2604172,gdp:4866,cont:"Africa éæ´²",flag:"ğŸ‡³ğŸ‡¦"},
  "524":{a2:"NP",name:"Nepal",cn:"å°¼æ³Šå°”",capital:"Kathmandu",capitalCn:"åŠ å¾·æ»¡éƒ½",pop:30896590,gdp:1337,cont:"Asia äºšæ´²",flag:"ğŸ‡³ğŸ‡µ"},
  "528":{a2:"NL",name:"Netherlands",cn:"è·å…°",capital:"Amsterdam",capitalCn:"é˜¿å§†æ–¯ç‰¹ä¸¹",pop:17618299,gdp:57025,cont:"Europe æ¬§æ´²",flag:"ğŸ‡³ğŸ‡±"},
  "554":{a2:"NZ",name:"New Zealand",cn:"æ–°è¥¿å…°",capital:"Wellington",capitalCn:"æƒ çµé¡¿",pop:5124100,gdp:48781,cont:"Oceania å¤§æ´‹æ´²",flag:"ğŸ‡³ğŸ‡¿"},
  "558":{a2:"NI",name:"Nicaragua",cn:"å°¼åŠ æ‹‰ç“œ",capital:"Managua",capitalCn:"é©¬é‚£ç“œ",pop:6948392,gdp:2045,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡³ğŸ‡®"},
  "562":{a2:"NE",name:"Niger",cn:"å°¼æ—¥å°”",capital:"Niamey",capitalCn:"å°¼äºšç¾",pop:26207977,gdp:553,cont:"Africa éæ´²",flag:"ğŸ‡³ğŸ‡ª"},
  "566":{a2:"NG",name:"Nigeria",cn:"å°¼æ—¥åˆ©äºš",capital:"Abuja",capitalCn:"é˜¿å¸ƒè´¾",pop:218541212,gdp:2066,cont:"Africa éæ´²",flag:"ğŸ‡³ğŸ‡¬"},
  "807":{a2:"MK",name:"North Macedonia",cn:"åŒ—é©¬å…¶é¡¿",capital:"Skopje",capitalCn:"æ–¯ç§‘æ™®é‡Œ",pop:1836713,gdp:6578,cont:"Europe æ¬§æ´²",flag:"ğŸ‡²ğŸ‡°"},
  "578":{a2:"NO",name:"Norway",cn:"æŒªå¨",capital:"Oslo",capitalCn:"å¥¥æ–¯é™†",pop:5457127,gdp:106149,cont:"Europe æ¬§æ´²",flag:"ğŸ‡³ğŸ‡´"},
  "512":{a2:"OM",name:"Oman",cn:"é˜¿æ›¼",capital:"Muscat",capitalCn:"é©¬æ–¯å–€ç‰¹",pop:5106626,gdp:20301,cont:"Asia äºšæ´²",flag:"ğŸ‡´ğŸ‡²"},
  "586":{a2:"PK",name:"Pakistan",cn:"å·´åŸºæ–¯å¦",capital:"Islamabad",capitalCn:"ä¼Šæ–¯å…°å ¡",pop:231402117,gdp:1505,cont:"Asia äºšæ´²",flag:"ğŸ‡µğŸ‡°"},
  "591":{a2:"PA",name:"Panama",cn:"å·´æ‹¿é©¬",capital:"Panama City",capitalCn:"å·´æ‹¿é©¬åŸ",pop:4408581,gdp:15731,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡µğŸ‡¦"},
  "598":{a2:"PG",name:"Papua New Guinea",cn:"å·´å¸ƒäºšæ–°å‡ å†…äºš",capital:"Port Moresby",capitalCn:"è«å°”å…¹æ¯”æ¸¯",pop:10142619,gdp:2897,cont:"Oceania å¤§æ´‹æ´²",flag:"ğŸ‡µğŸ‡¬"},
  "600":{a2:"PY",name:"Paraguay",cn:"å·´æ‹‰åœ­",capital:"AsunciÃ³n",capitalCn:"äºšæ¾æ£®",pop:6109644,gdp:5893,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡µğŸ‡¾"},
  "604":{a2:"PE",name:"Peru",cn:"ç§˜é²",capital:"Lima",capitalCn:"åˆ©é©¬",pop:33715471,gdp:7126,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡µğŸ‡ª"},
  "608":{a2:"PH",name:"Philippines",cn:"è²å¾‹å®¾",capital:"Manila",capitalCn:"é©¬å°¼æ‹‰",pop:115559009,gdp:3623,cont:"Asia äºšæ´²",flag:"ğŸ‡µğŸ‡­"},
  "616":{a2:"PL",name:"Poland",cn:"æ³¢å…°",capital:"Warsaw",capitalCn:"åæ²™",pop:37950802,gdp:18321,cont:"Europe æ¬§æ´²",flag:"ğŸ‡µğŸ‡±"},
  "620":{a2:"PT",name:"Portugal",cn:"è‘¡è„ç‰™",capital:"Lisbon",capitalCn:"é‡Œæ–¯æœ¬",pop:10352042,gdp:24567,cont:"Europe æ¬§æ´²",flag:"ğŸ‡µğŸ‡¹"},
  "634":{a2:"QA",name:"Qatar",cn:"å¡å¡”å°”",capital:"Doha",capitalCn:"å¤šå“ˆ",pop:2930524,gdp:66838,cont:"Asia äºšæ´²",flag:"ğŸ‡¶ğŸ‡¦"},
  "642":{a2:"RO",name:"Romania",cn:"ç½—é©¬å°¼äºš",capital:"Bucharest",capitalCn:"å¸ƒåŠ å‹’æ–¯ç‰¹",pop:19031335,gdp:15820,cont:"Europe æ¬§æ´²",flag:"ğŸ‡·ğŸ‡´"},
  "643":{a2:"RU",name:"Russia",cn:"ä¿„ç½—æ–¯",capital:"Moscow",capitalCn:"è«æ–¯ç§‘",pop:144236933,gdp:12172,cont:"Europe/Asia æ¬§äºš",flag:"ğŸ‡·ğŸ‡º"},
  "646":{a2:"RW",name:"Rwanda",cn:"å¢æ—ºè¾¾",capital:"Kigali",capitalCn:"åŸºåŠ åˆ©",pop:13461888,gdp:966,cont:"Africa éæ´²",flag:"ğŸ‡·ğŸ‡¼"},
  "682":{a2:"SA",name:"Saudi Arabia",cn:"æ²™ç‰¹é˜¿æ‹‰ä¼¯",capital:"Riyadh",capitalCn:"åˆ©é›…å¾—",pop:36408820,gdp:27607,cont:"Asia äºšæ´²",flag:"ğŸ‡¸ğŸ‡¦"},
  "686":{a2:"SN",name:"Senegal",cn:"å¡å†…åŠ å°”",capital:"Dakar",capitalCn:"è¾¾å–€å°”",pop:17763163,gdp:1637,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡³"},
  "688":{a2:"RS",name:"Serbia",cn:"å¡å°”ç»´äºš",capital:"Belgrade",capitalCn:"è´å°”æ ¼è±å¾·",pop:6664449,gdp:9230,cont:"Europe æ¬§æ´²",flag:"ğŸ‡·ğŸ‡¸"},
  "694":{a2:"SL",name:"Sierra Leone",cn:"å¡æ‹‰åˆ©æ˜‚",capital:"Freetown",capitalCn:"å¼—é‡Œæ•¦",pop:8605718,gdp:470,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡±"},
  "702":{a2:"SG",name:"Singapore",cn:"æ–°åŠ å¡",capital:"Singapore",capitalCn:"æ–°åŠ å¡",pop:5637022,gdp:65233,cont:"Asia äºšæ´²",flag:"ğŸ‡¸ğŸ‡¬"},
  "703":{a2:"SK",name:"Slovakia",cn:"æ–¯æ´›ä¼å…‹",capital:"Bratislava",capitalCn:"å¸ƒæ‹‰è¿ªæ–¯æ‹‰å‘",pop:5643453,gdp:20623,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¸ğŸ‡°"},
  "705":{a2:"SI",name:"Slovenia",cn:"æ–¯æ´›æ–‡å°¼äºš",capital:"Ljubljana",capitalCn:"å¢å¸ƒå°”é›…é‚£",pop:2107180,gdp:29291,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¸ğŸ‡®"},
  "090":{a2:"SB",name:"Solomon Islands",cn:"æ‰€ç½—é—¨ç¾¤å²›",capital:"Honiara",capitalCn:"éœå°¼äºšæ‹‰",pop:724273,gdp:2258,cont:"Oceania å¤§æ´‹æ´²",flag:"ğŸ‡¸ğŸ‡§"},
  "706":{a2:"SO",name:"Somalia",cn:"ç´¢é©¬é‡Œ",capital:"Mogadishu",capitalCn:"æ‘©åŠ è¿ªæ²™",pop:17597511,gdp:447,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡´"},
  "710":{a2:"ZA",name:"South Africa",cn:"å—é",capital:"Pretoria",capitalCn:"æ¯”å‹’é™€åˆ©äºš",pop:59893885,gdp:6994,cont:"Africa éæ´²",flag:"ğŸ‡¿ğŸ‡¦"},
  "728":{a2:"SS",name:"South Sudan",cn:"å—è‹ä¸¹",capital:"Juba",capitalCn:"æœ±å·´",pop:11193725,gdp:515,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡¸"},
  "724":{a2:"ES",name:"Spain",cn:"è¥¿ç­ç‰™",capital:"Madrid",capitalCn:"é©¬å¾·é‡Œ",pop:47615034,gdp:30103,cont:"Europe æ¬§æ´²",flag:"ğŸ‡ªğŸ‡¸"},
  "144":{a2:"LK",name:"Sri Lanka",cn:"æ–¯é‡Œå…°å¡",capital:"Sri Jayawardenepura Kotte",capitalCn:"ç§‘ç‰¹",pop:22156000,gdp:3474,cont:"Asia äºšæ´²",flag:"ğŸ‡±ğŸ‡°"},
  "729":{a2:"SD",name:"Sudan",cn:"è‹ä¸¹",capital:"Khartoum",capitalCn:"å–€åœŸç©†",pop:46874204,gdp:710,cont:"Africa éæ´²",flag:"ğŸ‡¸ğŸ‡©"},
  "740":{a2:"SR",name:"Suriname",cn:"è‹é‡Œå—",capital:"Paramaribo",capitalCn:"å¸•æ‹‰é©¬é‡Œåš",pop:618040,gdp:5274,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡¸ğŸ‡·"},
  "752":{a2:"SE",name:"Sweden",cn:"ç‘å…¸",capital:"Stockholm",capitalCn:"æ–¯å¾·å“¥å°”æ‘©",pop:10521556,gdp:55566,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¸ğŸ‡ª"},
  "756":{a2:"CH",name:"Switzerland",cn:"ç‘å£«",capital:"Bern",capitalCn:"ä¼¯å°”å°¼",pop:8796669,gdp:92434,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¨ğŸ‡­"},
  "760":{a2:"SY",name:"Syria",cn:"å™åˆ©äºš",capital:"Damascus",capitalCn:"å¤§é©¬å£«é©",pop:22125249,gdp:533,cont:"Asia äºšæ´²",flag:"ğŸ‡¸ğŸ‡¾"},
  "158":{a2:"TW",name:"Taiwan",cn:"å°æ¹¾",capital:"Taipei",capitalCn:"å°åŒ—",pop:23893394,gdp:32756,cont:"Asia äºšæ´²",flag:"ğŸ‡¹ğŸ‡¼"},
  "762":{a2:"TJ",name:"Tajikistan",cn:"å¡”å‰å…‹æ–¯å¦",capital:"Dushanbe",capitalCn:"æœå°šåˆ«",pop:10143543,gdp:887,cont:"Asia äºšæ´²",flag:"ğŸ‡¹ğŸ‡¯"},
  "834":{a2:"TZ",name:"Tanzania",cn:"å¦æ¡‘å°¼äºš",capital:"Dodoma",capitalCn:"å¤šå¤šé©¬",pop:65497748,gdp:1136,cont:"Africa éæ´²",flag:"ğŸ‡¹ğŸ‡¿"},
  "764":{a2:"TH",name:"Thailand",cn:"æ³°å›½",capital:"Bangkok",capitalCn:"æ›¼è°·",pop:71801279,gdp:7233,cont:"Asia äºšæ´²",flag:"ğŸ‡¹ğŸ‡­"},
  "626":{a2:"TL",name:"Timor-Leste",cn:"ä¸œå¸æ±¶",capital:"Dili",capitalCn:"å¸åŠ›",pop:1341296,gdp:1560,cont:"Asia äºšæ´²",flag:"ğŸ‡¹ğŸ‡±"},
  "768":{a2:"TG",name:"Togo",cn:"å¤šå“¥",capital:"LomÃ©",capitalCn:"æ´›ç¾",pop:8848699,gdp:915,cont:"Africa éæ´²",flag:"ğŸ‡¹ğŸ‡¬"},
  "780":{a2:"TT",name:"Trinidad and Tobago",cn:"ç‰¹ç«‹å°¼è¾¾å’Œå¤šå·´å“¥",capital:"Port of Spain",capitalCn:"è¥¿ç­ç‰™æ¸¯",pop:1534937,gdp:17823,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡¹ğŸ‡¹"},
  "788":{a2:"TN",name:"Tunisia",cn:"çªå°¼æ–¯",capital:"Tunis",capitalCn:"çªå°¼æ–¯",pop:12262946,gdp:3775,cont:"Africa éæ´²",flag:"ğŸ‡¹ğŸ‡³"},
  "792":{a2:"TR",name:"Turkey",cn:"åœŸè€³å…¶",capital:"Ankara",capitalCn:"å®‰å¡æ‹‰",pop:85279553,gdp:10616,cont:"Europe/Asia æ¬§äºš",flag:"ğŸ‡¹ğŸ‡·"},
  "795":{a2:"TM",name:"Turkmenistan",cn:"åœŸåº“æ›¼æ–¯å¦",capital:"Ashgabat",capitalCn:"é˜¿ä»€å“ˆå·´å¾·",pop:6430770,gdp:8280,cont:"Asia äºšæ´²",flag:"ğŸ‡¹ğŸ‡²"},
  "800":{a2:"UG",name:"Uganda",cn:"ä¹Œå¹²è¾¾",capital:"Kampala",capitalCn:"åå¸•æ‹‰",pop:47729952,gdp:964,cont:"Africa éæ´²",flag:"ğŸ‡ºğŸ‡¬"},
  "804":{a2:"UA",name:"Ukraine",cn:"ä¹Œå…‹å…°",capital:"Kyiv",capitalCn:"åŸºè¾…",pop:41167336,gdp:4534,cont:"Europe æ¬§æ´²",flag:"ğŸ‡ºğŸ‡¦"},
  "784":{a2:"AE",name:"United Arab Emirates",cn:"é˜¿è”é…‹",capital:"Abu Dhabi",capitalCn:"é˜¿å¸ƒæ‰æ¯”",pop:9441129,gdp:49451,cont:"Asia äºšæ´²",flag:"ğŸ‡¦ğŸ‡ª"},
  "826":{a2:"GB",name:"United Kingdom",cn:"è‹±å›½",capital:"London",capitalCn:"ä¼¦æ•¦",pop:67886011,gdp:46125,cont:"Europe æ¬§æ´²",flag:"ğŸ‡¬ğŸ‡§"},
  "840":{a2:"US",name:"United States",cn:"ç¾å›½",capital:"Washington D.C.",capitalCn:"åç››é¡¿ç‰¹åŒº",pop:331893745,gdp:76399,cont:"N. America åŒ—ç¾æ´²",flag:"ğŸ‡ºğŸ‡¸"},
  "858":{a2:"UY",name:"Uruguay",cn:"ä¹Œæ‹‰åœ­",capital:"Montevideo",capitalCn:"è’™å¾—ç»´çš„äºš",pop:3444263,gdp:20795,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡ºğŸ‡¾"},
  "860":{a2:"UZ",name:"Uzbekistan",cn:"ä¹Œå…¹åˆ«å…‹æ–¯å¦",capital:"Tashkent",capitalCn:"å¡”ä»€å¹²",pop:35163944,gdp:2255,cont:"Asia äºšæ´²",flag:"ğŸ‡ºğŸ‡¿"},
  "548":{a2:"VU",name:"Vanuatu",cn:"ç“¦åŠªé˜¿å›¾",capital:"Port Vila",capitalCn:"ç»´æ‹‰æ¸¯",pop:319137,gdp:3229,cont:"Oceania å¤§æ´‹æ´²",flag:"ğŸ‡»ğŸ‡º"},
  "862":{a2:"VE",name:"Venezuela",cn:"å§”å†…ç‘æ‹‰",capital:"Caracas",capitalCn:"åŠ æ‹‰åŠ æ–¯",pop:28838499,gdp:3740,cont:"S. America å—ç¾æ´²",flag:"ğŸ‡»ğŸ‡ª"},
  "704":{a2:"VN",name:"Vietnam",cn:"è¶Šå—",capital:"Hanoi",capitalCn:"æ²³å†…",pop:99461190,gdp:4164,cont:"Asia äºšæ´²",flag:"ğŸ‡»ğŸ‡³"},
  "887":{a2:"YE",name:"Yemen",cn:"ä¹Ÿé—¨",capital:"Sana'a",capitalCn:"è¨é‚£",pop:33696614,gdp:585,cont:"Asia äºšæ´²",flag:"ğŸ‡¾ğŸ‡ª"},
  "894":{a2:"ZM",name:"Zambia",cn:"èµæ¯”äºš",capital:"Lusaka",capitalCn:"å¢è¨å¡",pop:20017675,gdp:1291,cont:"Africa éæ´²",flag:"ğŸ‡¿ğŸ‡²"},
  "716":{a2:"ZW",name:"Zimbabwe",cn:"æ´¥å·´å¸ƒéŸ¦",capital:"Harare",capitalCn:"å“ˆæ‹‰é›·",pop:16320537,gdp:1737,cont:"Africa éæ´²",flag:"ğŸ‡¿ğŸ‡¼"},
  "732":{a2:"EH",name:"Western Sahara",cn:"è¥¿æ’’å“ˆæ‹‰",capital:"Laayoune",capitalCn:"é˜¿å°¤æ©",pop:612000,gdp:2500,cont:"Africa éæ´²",flag:"ğŸ‡ªğŸ‡­"},
  "-99":{a2:"XK",name:"Kosovo",cn:"ç§‘ç´¢æ²ƒ",capital:"Pristina",capitalCn:"æ™®é‡Œä»€è’‚çº³",pop:1782115,gdp:5269,cont:"Europe æ¬§æ´²",flag:"ğŸ‡½ğŸ‡°"},
  "275":{a2:"PS",name:"Palestine",cn:"å·´å‹’æ–¯å¦",capital:"Ramallah",capitalCn:"æ‹‰å§†å®‰æ‹‰",pop:5250000,gdp:3664,cont:"Asia äºšæ´²",flag:"ğŸ‡µğŸ‡¸"}
};

// Build lookups
const a2Lookup = {};
const a2ToNum = {};
for (const [numId, d] of Object.entries(countries)) {
  a2Lookup[d.a2] = { ...d, numId };
  a2ToNum[d.a2] = numId;
}

// ---- Color ----
const continentPalettes = {
  "Asia äºšæ´²":         ["#f59e0b","#f97316","#fbbf24","#fb923c","#fcd34d","#fdba74","#eab308","#ea580c","#d97706","#c2410c"],
  "Europe æ¬§æ´²":       ["#3b82f6","#6366f1","#818cf8","#60a5fa","#a5b4fc","#93c5fd","#4f46e5","#2563eb","#7c3aed","#4338ca"],
  "Europe/Asia æ¬§äºš":  ["#8b5cf6","#a78bfa","#c084fc"],
  "Africa éæ´²":       ["#10b981","#34d399","#6ee7b7","#059669","#14b8a6","#2dd4bf","#0d9488","#047857","#15803d","#16a34a","#22c55e","#4ade80"],
  "N. America åŒ—ç¾æ´²": ["#ef4444","#f43f5e","#fb7185","#e11d48","#dc2626","#f87171","#be123c","#b91c1c"],
  "S. America å—ç¾æ´²": ["#ec4899","#f472b6","#e879f9","#d946ef","#c026d3","#db2777","#a855f7","#9333ea"],
  "Oceania å¤§æ´‹æ´²":    ["#06b6d4","#22d3ee","#67e8f9","#0ea5e9","#38bdf8","#0891b2"]
};
const continentCounters = {};
function getCountryColor(cData) {
  if (!cData) return "#334155";
  const cont = cData.cont;
  const pal = continentPalettes[cont] || continentPalettes["Asia äºšæ´²"];
  if (!continentCounters[cont]) continentCounters[cont] = 0;
  const c = pal[continentCounters[cont] % pal.length];
  continentCounters[cont]++;
  return c;
}
function getCountryColorDirect(cData) {
  const cont = cData.cont;
  const pal = continentPalettes[cont] || continentPalettes["Asia äºšæ´²"];
  let h = 0;
  for (let i = 0; i < cData.a2.length; i++) h = (h * 31 + cData.a2.charCodeAt(i)) & 0xffff;
  return pal[h % pal.length];
}

// ---- Label sizing ----
const largePop = new Set(["CN","IN","US","RU","BR","ID","PK","NG","BD","MX","JP","ET","EG","DE","TR","FR","GB","IT","ZA","CA","AU","AR","SA","KZ","DZ"]);
const tinyCountries = new Set(["LU","SG","BN","DJ","SZ","LS","GW","TL","BT","VU","SB","CY","TT","JM","QA","KW","BZ","ME","MK","SI","SK","BA","HR","LV","EE","LT","AL","MD","AM","GE","AZ"]);

// ---- Map ----
const width = 960, height = 520;
const svg = d3.select("#map-svg")
  .attr("viewBox", `0 0 ${width} ${height}`)
  .attr("preserveAspectRatio", "xMidYMid meet");

const g = svg.append("g");

const zoomBehavior = d3.zoom()
  .scaleExtent([1, 12])
  .on("zoom", (event) => {
    g.attr("transform", event.transform);
    const k = event.transform.k;
    g.selectAll(".country-label")
      .style("font-size", function() {
        const base = this.classList.contains("label-lg") ? 8 : this.classList.contains("label-sm") ? 5 : 6.5;
        return (base / k) + "px";
      })
      .style("stroke-width", (1.5 / k) + "px");
    g.selectAll(".country-path")
      .style("stroke-width", (0.4 / k) + "px");
  });

svg.call(zoomBehavior);

const projection = d3.geoNaturalEarth1().scale(155).translate([width / 2, height / 2 + 10]);
const pathGen = d3.geoPath().projection(projection);

const tooltip = document.getElementById("tooltip");

// ---- Search state ----
let searchActive = false;
let focusedNumId = null;

const topoUrl = "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json";

d3.json(topoUrl).then(world => {
  const feats = topojson.feature(world, world.objects.countries).features;

  const colorMap = {};
  feats.forEach(f => {
    const numId = String(f.id);
    colorMap[numId] = getCountryColor(countries[numId]);
  });

  // Draw countries
  g.selectAll("path")
    .data(feats)
    .enter()
    .append("path")
    .attr("class", "country-path")
    .attr("d", pathGen)
    .attr("fill", d => colorMap[String(d.id)] || "#334155")
    .attr("data-id", d => String(d.id))
    .on("click", (event, d) => {
      if (searchActive) return;
      const cData = countries[String(d.id)];
      if (cData) showModal(cData, d);
    })
    .on("mousemove", (event, d) => {
      if (searchActive) return;
      const cData = countries[String(d.id)];
      if (cData) {
        tooltip.style.display = "block";
        tooltip.style.left = (event.clientX + 14) + "px";
        tooltip.style.top = (event.clientY - 10) + "px";
        document.getElementById("tt-name").textContent = cData.a2 + " â€” " + cData.name;
        document.getElementById("tt-cn").textContent = cData.cn;
      }
    })
    .on("mouseleave", () => { tooltip.style.display = "none"; });

  // Labels
  const labelG = g.append("g").attr("class", "labels-group");
  feats.forEach(f => {
    const numId = String(f.id);
    const cData = countries[numId];
    if (!cData) return;
    const centroid = pathGen.centroid(f);
    if (!centroid || isNaN(centroid[0])) return;
    const cls = largePop.has(cData.a2) ? "label-lg" : tinyCountries.has(cData.a2) ? "label-sm" : "";
    labelG.append("text")
      .attr("class", `country-label ${cls}`)
      .attr("x", centroid[0])
      .attr("y", centroid[1])
      .attr("data-id", numId)
      .text(cData.a2);
  });

  // Pulse ring group (above countries, below labels)
  const pulseG = g.append("g").attr("class", "pulse-group");

  // Store features
  window._countryFeatures = {};
  window._featsMap = {};
  feats.forEach(f => {
    const numId = String(f.id);
    const cData = countries[numId];
    if (cData) {
      window._countryFeatures[cData.a2] = f;
      window._featsMap[numId] = f;
    }
  });

  // ============================================================
  //  SEARCH LOGIC
  // ============================================================
  const searchBox = document.getElementById("search-box");
  const searchBtn = document.getElementById("search-btn");
  const searchHint = document.getElementById("search-hint");
  const acBox = document.getElementById("autocomplete");

  // Enable/disable search button based on input length
  searchBox.addEventListener("input", () => {
    const v = searchBox.value.replace(/[^a-zA-Z]/g, '').toUpperCase();
    searchBox.value = v;
    searchBtn.disabled = v.length < 2;
    if (v.length < 2) {
      searchHint.textContent = v.length === 0 ? "è¾“å…¥2ä½å­—æ¯ä»£ç " : "å†è¾“å…¥1ä½...";
      searchHint.classList.remove("error");
    } else {
      searchHint.textContent = "æŒ‰ Enter æˆ–ç‚¹å‡»æœç´¢";
      searchHint.classList.remove("error");
    }
    showAutocomplete(v);
  });

  // Enter triggers search
  searchBox.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && searchBox.value.length >= 2) {
      acBox.classList.remove("show");
      executeSearch(searchBox.value.toUpperCase());
    }
    // Arrow nav in autocomplete
    if (acBox.classList.contains("show")) {
      const items = acBox.querySelectorAll(".ac-item");
      const activeIdx = [...items].findIndex(i => i.classList.contains("active"));
      if (e.key === "ArrowDown") {
        e.preventDefault();
        items.forEach(i => i.classList.remove("active"));
        items[(activeIdx + 1) % items.length].classList.add("active");
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        items.forEach(i => i.classList.remove("active"));
        items[(activeIdx - 1 + items.length) % items.length].classList.add("active");
      } else if (e.key === "Enter" && activeIdx >= 0) {
        e.preventDefault();
        acBox.classList.remove("show");
        const code = items[activeIdx].dataset.code;
        searchBox.value = code;
        executeSearch(code);
      }
    }
  });

  searchBtn.addEventListener("click", () => {
    acBox.classList.remove("show");
    if (searchBox.value.length >= 2) executeSearch(searchBox.value.toUpperCase());
  });

  function showAutocomplete(q) {
    acBox.innerHTML = "";
    if (q.length === 0) { acBox.classList.remove("show"); return; }
    const matches = [];
    for (const [numId, cData] of Object.entries(countries)) {
      if (cData.a2.startsWith(q) || cData.name.toUpperCase().startsWith(q)) {
        matches.push(cData);
      }
    }
    if (matches.length === 0 || (matches.length === 1 && matches[0].a2 === q)) {
      acBox.classList.remove("show");
      return;
    }
    matches.sort((a, b) => a.a2.localeCompare(b.a2));
    matches.slice(0, 8).forEach((c, idx) => {
      const div = document.createElement("div");
      div.className = "ac-item" + (idx === 0 ? " active" : "");
      div.dataset.code = c.a2;
      div.innerHTML = `<span class="ac-flag">${c.flag}</span><span class="ac-code">${c.a2}</span><span class="ac-name">${c.name}</span><span class="ac-cn">${c.cn}</span>`;
      div.addEventListener("click", () => {
        searchBox.value = c.a2;
        acBox.classList.remove("show");
        executeSearch(c.a2);
      });
      acBox.appendChild(div);
    });
    acBox.classList.add("show");
  }

  // Hide autocomplete on outside click
  document.addEventListener("click", (e) => {
    if (!e.target.closest("#controls")) acBox.classList.remove("show");
  });

  // ---- Execute search with animation ----
  function executeSearch(code) {
    const cData = a2Lookup[code];
    if (!cData) {
      searchHint.textContent = `âŒ æœªæ‰¾åˆ° "${code}"`;
      searchHint.classList.add("error");
      return;
    }

    const numId = cData.numId;
    const feature = window._featsMap[numId];
    if (!feature) {
      searchHint.textContent = `âŒ åœ°å›¾æ— æ•°æ®`;
      searchHint.classList.add("error");
      return;
    }

    searchHint.textContent = `âœ“ ${cData.flag} ${cData.name}`;
    searchHint.classList.remove("error");
    searchActive = true;
    focusedNumId = numId;
    tooltip.style.display = "none";

    // 1. Dim all other countries & labels
    g.selectAll(".country-path").classed("dimmed", d => String(d.id) !== numId).classed("search-focus", d => String(d.id) === numId);
    g.selectAll(".country-label").classed("dimmed", function() { return this.dataset.id !== numId; });

    // 2. Compute zoom transform to center the country
    const [[x0, y0], [x1, y1]] = pathGen.bounds(feature);
    const cx = (x0 + x1) / 2;
    const cy = (y0 + y1) / 2;
    const bw = x1 - x0;
    const bh = y1 - y0;
    // Target: country fills ~40% of viewport height (leave room for bottom panel)
    const targetH = height * 0.38;
    const targetW = width * 0.5;
    const scale = Math.min(targetW / Math.max(bw, 1), targetH / Math.max(bh, 1), 10);
    // Offset center upward so bottom panel doesn't cover it
    const tx = width / 2 - cx * scale;
    const ty = (height * 0.4) - cy * scale;

    const transform = d3.zoomIdentity.translate(tx, ty).scale(scale);

    svg.transition()
      .duration(1200)
      .ease(d3.easeCubicInOut)
      .call(zoomBehavior.transform, transform);

    // 3. Add pulse ring at centroid
    pulseG.selectAll("*").remove();
    const centroid = pathGen.centroid(feature);
    if (centroid && !isNaN(centroid[0])) {
      for (let i = 0; i < 3; i++) {
        pulseG.append("circle")
          .attr("class", "pulse-ring")
          .attr("cx", centroid[0])
          .attr("cy", centroid[1])
          .attr("r", 0)
          .style("animation-delay", (i * 0.6) + "s");
      }
    }

    // 4. Show bottom detail panel
    showDetailPanel(cData);
  }

  // ---- Cancel search: animate back ----
  document.getElementById("cancel-btn").addEventListener("click", cancelSearch);

  function cancelSearch() {
    if (!searchActive) return;
    searchActive = false;
    focusedNumId = null;

    // Hide panel
    document.getElementById("detail-panel").classList.remove("active");

    // Remove dim/focus
    g.selectAll(".country-path").classed("dimmed", false).classed("search-focus", false);
    g.selectAll(".country-label").classed("dimmed", false);

    // Remove pulse
    pulseG.selectAll("*").remove();

    // Animate back to original zoom
    svg.transition()
      .duration(1000)
      .ease(d3.easeCubicInOut)
      .call(zoomBehavior.transform, d3.zoomIdentity);

    // Reset search UI
    searchBox.value = "";
    searchBtn.disabled = true;
    searchHint.textContent = "è¾“å…¥2ä½å­—æ¯ä»£ç ";
    searchHint.classList.remove("error");
  }

  // ESC also cancels
  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && searchActive) cancelSearch();
    if (e.key === "Escape" && !searchActive) closeModal();
  });

  // ---- Detail panel ----
  function showDetailPanel(cData) {
    document.getElementById("detail-flag").textContent = cData.flag;
    document.getElementById("detail-en-text").textContent = cData.name;
    document.getElementById("detail-name-cn").textContent = cData.cn;

    const stats = document.getElementById("detail-stats");
    stats.innerHTML = `
      <div class="stat-card">
        <div class="stat-icon">ğŸ›ï¸</div>
        <div class="stat-label">Capital é¦–éƒ½</div>
        <div class="stat-value">${cData.capital}</div>
        <div class="stat-sub">${cData.capitalCn}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-label">Population äººå£</div>
        <div class="stat-value">${cData.pop.toLocaleString()}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-label">GDP/Capita äººå‡GDP</div>
        <div class="stat-value">$${cData.gdp.toLocaleString()}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸŒ</div>
        <div class="stat-label">Code ä»£ç </div>
        <div class="stat-value">${cData.a2}</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-label">Continent æ´²</div>
        <div class="stat-value">${cData.cont}</div>
      </div>
    `;

    // Slight delay so animation triggers
    requestAnimationFrame(() => {
      document.getElementById("detail-panel").classList.add("active");
    });
  }

  // Speak on click English name in detail panel
  document.getElementById("detail-name-en").addEventListener("click", () => {
    const name = document.getElementById("detail-en-text").textContent;
    speakText(name);
  });
});

// ---- Modal (for direct map click) ----
function showModal(cData, feature) {
  document.getElementById("modal-flag").textContent = cData.flag;
  document.getElementById("modal-country-name").textContent = cData.name;
  document.getElementById("modal-country-cn").textContent = cData.cn;
  document.getElementById("info-capital").textContent = cData.capital;
  document.getElementById("info-capital-cn").textContent = cData.capitalCn;
  document.getElementById("info-population").textContent = cData.pop.toLocaleString();
  document.getElementById("info-gdp").textContent = "$" + cData.gdp.toLocaleString();
  document.getElementById("info-code").textContent = cData.a2;
  document.getElementById("info-continent").textContent = cData.cont;

  const shapeSvg = d3.select("#country-shape-svg");
  shapeSvg.selectAll("*").remove();
  if (feature) {
    const sp = d3.geoMercator();
    const sPath = d3.geoPath().projection(sp);
    sp.fitSize([180, 160], feature);
    shapeSvg.append("path")
      .attr("d", sPath(feature))
      .attr("fill", getCountryColorDirect(cData))
      .attr("stroke", "#fff")
      .attr("stroke-width", 1.5)
      .attr("class", "zoomed-country")
      .attr("transform", "translate(5,5)");
  }
  document.getElementById("modal-overlay").classList.add("active");
}

function closeModal() {
  document.getElementById("modal-overlay").classList.remove("active");
}
document.getElementById("modal-close").addEventListener("click", closeModal);
document.getElementById("modal-overlay").addEventListener("click", function(e) {
  if (e.target === this) closeModal();
});

// ---- TTS ----
function speakText(text) {
  if (!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US';
  u.rate = 0.85;
  const voices = window.speechSynthesis.getVoices();
  const v = voices.find(v => v.lang === 'en-US') || voices.find(v => v.lang.startsWith('en'));
  if (v) u.voice = v;
  window.speechSynthesis.speak(u);
}

document.getElementById("speak-btn").addEventListener("click", function() {
  const name = document.getElementById("modal-country-name").textContent;
  speakText(name);
  this.textContent = 'ğŸ”Š Speaking...';
  const btn = this;
  const u = window.speechSynthesis;
  const check = setInterval(() => {
    if (!u.speaking) { btn.textContent = 'ğŸ”Š Hear Pronunciation'; clearInterval(check); }
  }, 200);
});

if ('speechSynthesis' in window) {
  window.speechSynthesis.getVoices();
  window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
}
</script>
</body>
</html>
